\input{common-header}
\input{frontcover}
\input{regulatory}
\input{updates}

\megabookstart{Developing for the MEGA65}{WORK IN PROGRESS}

\input{introduction}

\cleardoublepage
\pagenumbering{arabic}

\part{INTRODUCTION}

\chapter{Welcome, and thank you!}

I would like to begin by thanking you for your interest in the MEGA65,
and in developing software to run on it. The success of the MEGA65 as
a fun retro-computing platform depends on there being enough
interesting software for people to run on it.  This requires the
generous work of developers like yourself. So, again, thank you!

But developing for the MEGA65 is not merely a case of giving to the
benefit of others. We have tried hard to create a machine that is as
fun to program as the Commodore 64, but with some of the barriers
and frustrations worn down somewhat.  That is, it is our intention
that people develop on the MEGA65 because it is fun, and then enjoy
the process.  That is, the journey should very much be the
destination.

Now, in saying that, the MEGA65 is quite new, and we have been flat
out creating the machine. This means that some development tools are
not as ready or as simple or integrated as we would like.  Improving
the tools is also an area where we hope that many of you will enjoy
contributing, so that developing for the MEGA65 can become accessible
to as many people as possible.

If you encounter barriers to your
journey of developing for the MEGA65, please do let us know, and
consider creating solutions that can be shared with others.  This will
help everyone to enjoy being an active part of the MEGA65 ecosystem.

Finally, my apologies to anyone who has developed tools or utilities
for the MEGA65 that have escaped my memory as I have written this
document.  If this is the case, please drop me an email, and I'll
update this document to include them.

\chapter{Other Resources}

This book focusses on the process of developing for the MEGA65.  To
avoid it being a thousand pages long, it doesn't describe the inner
workings of the MEGA65, except where you need to know about them, so
that you can engage in the development process.  For example, if you
wish to know about the capabilities of the various custom chips in the
MEGA65, and which registers do which things, please refer to {\em the
MEGA65 Book} online
at \url{https://github.com/mega65/mega65-user-guide}, or consider
purchasing one or more of the reference volumes for the MEGA65, from
which the MEGA65 Book is formed.  For example, the {\em MEGA65 Chipset
Reference Guide} or the {\em MEGA65 Assembly Language Reference Guide}.

We also hope that you, the developer community, will contribute to
those books, or write your own material that can help others in their
journeys with developing for the MEGA65.

\part{CROSS-PLATFORM DEVELOPMENT TOOLS}

\input{emulators}
\input{transferanddebugging}
\input{assemblers}
\input{ccompilers}
\input{libc}
\input{basictokenisers}

\part{NATIVE DEVELOPMENT TOOLS}

\chapter{C65 Memory Monitor}

\chapter{MEGA65 Matrix Mode}

\chapter{Turbo Assembler}

\chapter{Dealing with C65 and C64-mode}

The MEGA65 normally starts in C65-mode, and there is appeal in making
programs that can start directly from C65-mode.  However, the
different versions of the C65 ROM make this difficult, as there are
differences in the memory location of various system variables and ROM
routines.  If you are developing a program in assembly language or
C, it is typically easier to develop it for C64-mode.

But that leaves
you with the problem of how to allow it to be started from C65-mode.
Our solution to this is the \stw{c65toc65wrapper.asm} program.  This
short program can be found in the \stw{src/utilities} directory of
the \url{https://github.com/mega65/mega65-tools} repository.  When
compiled, it produces a short program that you can pre-pend to your
C64-mode oriented MEGA65 program, and have it automatically detect
C64 or C65-mode, switch to C64-mode if required, and set your
program going. It also switches the CPU to 40MHz.  The only
assumption it makes, is that your program should be started using
\stw{SYS 2061}

This program is particularly handy when using exomizer, as by having
the CPU set to 40MHz before depacking allows depacking to happen
almost instantly.  This is important on the MEGA65, as loading a
program often takes only a fraction of a second, but depacking an
exomized program at 1MHz can take several seconds.

Finally, you can use this approach to create bootable disks for the
MEGA65, by placing the file onto the disk with the
name \stw{AUTOBOOT.C65}.  This allows you to use C64-mode programs
to autoboot on the MEGA65, which is itself very convenient.

\part{MEGA65 Operating System}

\input{developing-system-programs}

{\input{appendix-hypervisor-calls}}

\part{MULTI-MEDIA AND DATA CONVERSION}

\part{GEOS Development}

\part{HARDWARE}

\input{nexys4ddr-setup}

\part{APPENDICES}

\appendix
  \input{appendix-mega65r2-flashing}
  \input{appendix-troubleshooting}
  \input{appendix-schematics}
  \input{appendix-donors}


\nocite{*}
\bibliographystyle{IEEEtran}
\bibliography{references}

\printindex

\input{common-footer}

